<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="normalize.css" />

    <link rel="stylesheet" type="text/css" href="prettify.css" />
    <script src="prettify.js"></script>

    <link rel="stylesheet" type="text/css" href="index.css" />
  </head>

  <body onload="prettyPrint();">

    <h1>Javascript Coroutines and Event Handling</h1>

    <p>Javascript 1.7 adds support for Python-style generators and coroutines, using the <code>yield</code> keyword.</p>

    <p>Javascript makes heavy use of callbacks, which make Javascript coroutines particularly interesting because they can be used to 'invert' multiple callbacks into a single imperative event loop.</p>

    <h2>For Example</h2>

    <p>Anyone who has programmed simple low-level UIs has probably written some code to handle dragging, which generally works like:</p>
    <blockquote>Wait for the user to mousedown on something.<br/>Now if they mousemove it counts as dragging,<br/>until they mouseup.</blockquote>

    <p>This can be implemented with three callbacks, for <code>mousedown</code>, <code>mousemove</code>, and <code>mouseup</code>, and a shared <code>dragging</code> variable.</p>

    <p>Or it can be implemented as a single coroutine event loop, which is always either in the not-dragging state of waiting for a <code>mousedown</code>, or in the dragging state of responding to <code>mousemove</code> and waiting for a <code>mouseup</code>.</p>

    <div class="figure">
      <p>dragging with callbacks and shared state</p>
      <pre class="prettyprint">
var dragging = false;
function onmousedown(event) {
    dragging = true;
}
function onmousemove(event) {
    if (dragging)
        move(event);
}
function onmouseup(event) {
    dragging = false;
}
      </pre>
    </div>

    <div class="figure">
      <p>dragging with a coroutine event loop</p>
      <pre class="prettyprint">
function loop() {
    var event;
    while (event = (yield)) { // not dragging
        if (event.type == 'mousedown') {
            while (event = (yield)) { // dragging
                if (event.type == 'mousemove') move(event);
                if (event.type == 'mouseup') break;
            }
        }
    }
}
      </pre>
    </div>

    <p>...</p>

  </body>
</html>
